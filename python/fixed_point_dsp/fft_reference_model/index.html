
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A digital garden documenting DSP, FPGA, and ASIC implementation.">
      
      
        <meta name="author" content="Arun Jeevaraj">
      
      
      
        <link rel="prev" href="../quantization_basics/">
      
      
        <link rel="next" href="../../../til/">
      
      
        
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>FFT reference model in python - Arun's Learning Journal</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fft-reference-model-floating-point" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Arun&#39;s Learning Journal" class="md-header__button md-logo" aria-label="Arun's Learning Journal" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Arun's Learning Journal
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              FFT reference model in python
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../books/books/" class="md-tabs__link">
        
  
  
    
  
  Books

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../DSP/algorithms/dft_vs_fft/" class="md-tabs__link">
          
  
  
  DSP

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../quantization_basics/" class="md-tabs__link">
          
  
  
  Python DSP

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../til/" class="md-tabs__link">
        
  
  
    
  
  Today I Learned

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Arun&#39;s Learning Journal" class="md-nav__button md-logo" aria-label="Arun's Learning Journal" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Arun's Learning Journal
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../books/books/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Books
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    DSP
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    DSP
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../DSP/algorithms/dft_vs_fft/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FFT vs DFT Complexity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Python DSP
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Python DSP
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../quantization_basics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Fixed-Point Quantization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    FFT reference model in python
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    FFT reference model in python
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#key-sub-blocks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Key Sub-Blocks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-the-butterfly-hardware-block" class="md-nav__link">
    <span class="md-ellipsis">
      
        1. The Butterfly "Hardware" Block
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. The Butterfly &#34;Hardware&#34; Block">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-gauss-complex-multiplication" class="md-nav__link">
    <span class="md-ellipsis">
      
        1.1 Gauss Complex Multiplication
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1.1 Gauss Complex Multiplication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hardware-requirement-summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hardware Requirement Summary
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#python-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Python Implementation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-bit-reversal-for-indices-and-a-ram-to-store-the-data" class="md-nav__link">
    <span class="md-ellipsis">
      
        2. Bit Reversal for Indices and a RAM to store the data.
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Bit Reversal for Indices and a RAM to store the data.">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-python-implementation-of-the-ram" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 python implementation of the RAM.
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-conflict-free-memory-xor-strategy-addressing" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 Conflict-Free Memory: XOR Strategy &amp; Addressing
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-twiddle-factor-architecture-rom-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        3. Twiddle Factor Architecture (ROM Optimization)
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Twiddle Factor Architecture (ROM Optimization)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31-quarter-wave-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.1 Quarter-Wave Optimization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-quadrant-mapping-logic-the-mirror" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.2 Quadrant Mapping Logic (The Mirror)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33-hardware-address-decoding-bit-shifting" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.3 Hardware Address Decoding (Bit-Shifting)
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34-python-implementation-twiddlerom" class="md-nav__link">
    <span class="md-ellipsis">
      
        3.4 Python Implementation: TwiddleROM
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../til/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Today I Learned
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="fft-reference-model-floating-point">FFT Reference Model (Floating-Point)</h1>
<p>Before moving to Fixed-Point ASIC implementation, it is important to have a reference model to test out the concept and act as a scoreboard in the testbench. For that purpose, it is crucial to have a floating-point reference model.</p>
<p>We will use a <strong>bottom-up approach</strong> here. Getting the basic building blocks built first, tested, and the concept understood is a good way to proceed.</p>
<h3 id="key-sub-blocks">Key Sub-Blocks</h3>
<ul>
<li>
<p><strong>Bit Reversal for Indices and a RAM to store the data.</strong>
    This has to be done either at the input level or the output level of the FFT. A RAM to mimic the hardware is a good idea here.</p>
</li>
<li>
<p><strong>Butterfly Unit</strong>
    For performing FFT, one of the basic blocks is a FFT butterfly. To keep things simple, let's focus on building the FFT with a <strong>Radix-2</strong> butterfly. The Butterfly needs to perform complex multiplication operations.</p>
</li>
<li>
<p><strong>FFT Stages and Data Feeding</strong>
    The butterfly "spans its wings" based on the FFT stage. FFT relies on splitting an <span class="arithmatex">\(N\)</span>-point FFT to <span class="arithmatex">\(N/2\)</span>-point FFT of even and odd indices and making use of the twiddle factor symmetry. This is basically controlling the data flow to the butterfly and controlling the stages.</p>
</li>
<li>
<p><strong>FFT twiddle factor LUT</strong>
    The LUT would be used to generate the twiddle factor which is needed for each stage of the FFT.</p>
</li>
</ul>
<hr />
<h2 id="1-the-butterfly-hardware-block">1. The Butterfly "Hardware" Block</h2>
<p>In a physical ASIC, the butterfly is a logic cluster of 4 multipliers and 6 adders.</p>
<div class="arithmatex">\[X[k] = E[k] + W_N^k O[k]\]</div>
<div class="arithmatex">\[X[k + N/2] = E[k] - W_N^k O[k]\]</div>
<p>By feeding <span class="arithmatex">\(E[k]\)</span> and <span class="arithmatex">\(O[k]\)</span> terms to the butterfly, one could compute <span class="arithmatex">\(X[k]\)</span> and <span class="arithmatex">\(X[k + N/2]\)</span>. This involves two complex multipliers and two complex adders.</p>
<p>The complex multiplication typically needs 4 multiplications, but this can be reduced to <strong>3 multiplications</strong> by using the Gauss multiplication method.</p>
<h3 id="11-gauss-complex-multiplication">1.1 Gauss Complex Multiplication</h3>
<p><strong>Step 1: The "Overlap" Term</strong>
Let's create a common multiplication that uses both real and imaginary parts of our numbers. We will call it <span class="arithmatex">\(k_1\)</span>:</p>
<div class="arithmatex">\[k_1 = C \cdot (A + B)\]</div>
<p>If we expand this, we get:
$<span class="arithmatex">\(k_1 = AC + BC\)</span>$</p>
<p>Notice that <span class="arithmatex">\(AC\)</span> is part of our desired Real result, and <span class="arithmatex">\(BC\)</span> is part of our desired Imaginary result.</p>
<p><strong>Step 2: Isolating the Real Part</strong>
We want <span class="arithmatex">\(AC - BD\)</span>. We already have <span class="arithmatex">\(AC + BC\)</span> from <span class="arithmatex">\(k_1\)</span>. To get rid of that <span class="arithmatex">\(+BC\)</span> and turn it into <span class="arithmatex">\(-BD\)</span>, we need another multiplication. Let's try to find a term that involves <span class="arithmatex">\(B\)</span>:</p>
<div class="arithmatex">\[k_3 = B \cdot (C + D) = BC + BD\]</div>
<p>Now, look what happens if we subtract <span class="arithmatex">\(k_3\)</span> from <span class="arithmatex">\(k_1\)</span>:
$<span class="arithmatex">\(k_1 - k_3 = (AC + BC) - (BC + BD)\)</span>$
$<span class="arithmatex">\(k_1 - k_3 = AC - BD\)</span>$</p>
<p><strong>This is exactly our Real Part!</strong></p>
<p><strong>Step 3: Isolating the Imaginary Part</strong>
We want <span class="arithmatex">\(AD + BC\)</span>. We already have <span class="arithmatex">\(AC + BC\)</span> from <span class="arithmatex">\(k_1\)</span>. To get rid of the <span class="arithmatex">\(+AC\)</span> and turn it into <span class="arithmatex">\(+AD\)</span>, we need a term that involves <span class="arithmatex">\(A\)</span>:</p>
<div class="arithmatex">\[k_2 = A \cdot (D - C) = AD - AC\]</div>
<p>Now, look what happens if we add <span class="arithmatex">\(k_1\)</span> and <span class="arithmatex">\(k_2\)</span>:
$<span class="arithmatex">\(k_1 + k_2 = (AC + BC) + (AD - AC)\)</span>$
$<span class="arithmatex">\(k_1 + k_2 = BC + AD\)</span>$</p>
<p><strong>This is exactly our Imaginary Part!</strong></p>
<h4 id="hardware-requirement-summary">Hardware Requirement Summary</h4>
<table>
<thead>
<tr>
<th style="text-align: left;">Intermediate</th>
<th style="text-align: left;">Operation</th>
<th style="text-align: left;">Hardware Requirement</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong><span class="arithmatex">\(k_1\)</span></strong></td>
<td style="text-align: left;"><span class="arithmatex">\(C \cdot (A + B)\)</span></td>
<td style="text-align: left;">1 Mult, 1 Add</td>
</tr>
<tr>
<td style="text-align: left;"><strong><span class="arithmatex">\(k_2\)</span></strong></td>
<td style="text-align: left;"><span class="arithmatex">\(A \cdot (D - C)\)</span></td>
<td style="text-align: left;">1 Mult, 1 Sub</td>
</tr>
<tr>
<td style="text-align: left;"><strong><span class="arithmatex">\(k_3\)</span></strong></td>
<td style="text-align: left;"><span class="arithmatex">\(B \cdot (C + D)\)</span></td>
<td style="text-align: left;">1 Mult, 1 Add</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Real Result</strong></td>
<td style="text-align: left;"><span class="arithmatex">\(k_1 - k_3\)</span></td>
<td style="text-align: left;">1 Sub</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Imag Result</strong></td>
<td style="text-align: left;"><span class="arithmatex">\(k_1 + k_2\)</span></td>
<td style="text-align: left;">1 Add</td>
</tr>
</tbody>
</table>
<h3 id="python-implementation">Python Implementation</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">multiplier_3mul</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">):</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="sd">    Computes (A + jB) * (C + jD) using Gauss&#39;s 3-multiplier method.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>    <span class="c1"># Pre-additions (Cheap in Silicon)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>    <span class="n">sum_AB</span> <span class="o">=</span> <span class="n">A</span> <span class="o">+</span> <span class="n">B</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>    <span class="n">diff_DC</span> <span class="o">=</span> <span class="n">D</span> <span class="o">-</span> <span class="n">C</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>    <span class="n">sum_CD</span> <span class="o">=</span> <span class="n">C</span> <span class="o">+</span> <span class="n">D</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="c1"># 3 Multiplications (Expensive in Silicon)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    <span class="n">k1</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="n">sum_AB</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>    <span class="n">k2</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">diff_DC</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="n">k3</span> <span class="o">=</span> <span class="n">B</span> <span class="o">*</span> <span class="n">sum_CD</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="c1"># Final assembly</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>    <span class="n">real_out</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">-</span> <span class="n">k3</span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="n">imag_out</span> <span class="o">=</span> <span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="k">return</span> <span class="n">real_out</span><span class="p">,</span> <span class="n">imag_out</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="k">def</span><span class="w"> </span><span class="nf">butterfly_unit</span><span class="p">(</span><span class="n">A_re</span><span class="p">,</span> <span class="n">A_im</span><span class="p">,</span> <span class="n">B_re</span><span class="p">,</span> <span class="n">B_im</span><span class="p">,</span> <span class="n">W_re</span><span class="p">,</span> <span class="n">W_im</span><span class="p">):</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>    <span class="c1"># Twiddle product: (B_re + jB_im) * (W_re + jW_im)</span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>    <span class="n">twid_re</span><span class="p">,</span> <span class="n">twid_im</span> <span class="o">=</span> <span class="n">multiplier_3mul</span><span class="p">(</span><span class="n">B_re</span><span class="p">,</span> <span class="n">B_im</span><span class="p">,</span> <span class="n">W_re</span><span class="p">,</span> <span class="n">W_im</span><span class="p">)</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>    <span class="c1"># Sum/Diff stage</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>    <span class="n">up_re</span><span class="p">,</span> <span class="n">up_im</span> <span class="o">=</span> <span class="n">A_re</span> <span class="o">+</span> <span class="n">twid_re</span><span class="p">,</span> <span class="n">A_im</span> <span class="o">+</span> <span class="n">twid_im</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>    <span class="n">low_re</span><span class="p">,</span> <span class="n">low_im</span> <span class="o">=</span> <span class="n">A_re</span> <span class="o">-</span> <span class="n">twid_re</span><span class="p">,</span> <span class="n">A_im</span> <span class="o">-</span> <span class="n">twid_im</span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>    <span class="k">return</span> <span class="n">up_re</span><span class="p">,</span> <span class="n">up_im</span><span class="p">,</span> <span class="n">low_re</span><span class="p">,</span> <span class="n">low_im</span>
</code></pre></div>
<h2 id="2-bit-reversal-for-indices-and-a-ram-to-store-the-data">2. Bit Reversal for Indices and a RAM to store the data.</h2>
<p><img alt="Fig 2.1 A simplified butterfly map" src="../../../assets/figures/DSP/fft8_radix2.drawio.svg" /></p>
<p>The data as it moves across the butterfly stages, get shuffled due to sorting them by even and odd indices as shown in the figure.
so to revert back the order of the FFT, a bit reversal of the indices are needed.
This can be done either at the start or at the end of the FFT.</p>
<p>since we are going for a radix 2 butterfly design, two instances of data needs to be read simultaneously. To solve this problem, we could add two single port RAM with half the size. </p>
<p>Following that train of thoughts. One way of partitioning the data, would be move the odd indices to One RAM and the viceversa. This would work for stage 1, but for stage 2 the two reads will end up from the same 
RAM. Oops.</p>
<p>The solution is simple. </p>
<p>For Stage 1, the data read spans by changing the LSB bit.
For stage 2, the data read spans by changing the 2nd LSB bit.
For stage 3, the data read spans by changing the 3rd LSB bit. </p>
<p>So we could use XOR based banking. Which is to use the parity of the XOR sum of all the bits of the address to resolve the banking..</p>
<h3 id="21-python-implementation-of-the-ram">2.1 python implementation of the RAM.</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">XOR_RAM</span><span class="p">:</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="sd">    Dual-Bank RAM with Parity Banking &amp; Dense Addressing.</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bank0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>  <span class="c1"># Even Parity Bank</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bank1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">depth</span>  <span class="c1"># Odd Parity Bank</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logical_addr</span><span class="p">):</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="sd">        Hardware Decoder:</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="sd">        - Bank = XOR Sum of bits (Parity)</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="sd">        - Row  = Logical Address &gt;&gt; 1</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>        <span class="n">bank</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">logical_addr</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>        <span class="n">row</span>  <span class="o">=</span> <span class="n">logical_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>        <span class="k">return</span> <span class="n">bank</span><span class="p">,</span> <span class="n">row</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr_A</span><span class="p">,</span> <span class="n">addr_B</span><span class="p">):</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="sd">        Simulates a simultaneous read. Returns details for printing.</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="sd">        Raises ValueError if a collision occurs.</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>        <span class="n">bank_A</span><span class="p">,</span> <span class="n">row_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="n">addr_A</span><span class="p">)</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>        <span class="n">bank_B</span><span class="p">,</span> <span class="n">row_B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_translate</span><span class="p">(</span><span class="n">addr_B</span><span class="p">)</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>        <span class="k">if</span> <span class="n">bank_A</span> <span class="o">==</span> <span class="n">bank_B</span><span class="p">:</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CONFLICT! </span><span class="si">{</span><span class="n">addr_A</span><span class="si">}</span><span class="s2"> &amp; </span><span class="si">{</span><span class="n">addr_B</span><span class="si">}</span><span class="s2"> -&gt; Both Bank </span><span class="si">{</span><span class="n">bank_A</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">bank_A</span><span class="p">,</span> <span class="n">row_A</span><span class="p">),</span> <span class="p">(</span><span class="n">bank_B</span><span class="p">,</span> <span class="n">row_B</span><span class="p">)</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="k">def</span><span class="w"> </span><span class="nf">verify_fft_8_banking</span><span class="p">():</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>    <span class="n">N</span> <span class="o">=</span> <span class="mi">8</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>    <span class="n">stages</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>    <span class="n">ram</span> <span class="o">=</span> <span class="n">XOR_RAM</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;Stage&#39;</span><span class="si">:</span><span class="s2">&lt;6</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;Pair (Logical)&#39;</span><span class="si">:</span><span class="s2">&lt;16</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;Bin A&#39;</span><span class="si">:</span><span class="s2">&lt;6</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Bin B&#39;</span><span class="si">:</span><span class="s2">&lt;6</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;Bank A&#39;</span><span class="si">:</span><span class="s2">&lt;7</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39;Bank B&#39;</span><span class="si">:</span><span class="s2">&lt;7</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="s1">&#39;Result&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>    <span class="c1"># Simulate FFT AGU Loops</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">stages</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>        <span class="n">span</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>        <span class="n">m</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">s</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a>            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">span</span><span class="p">):</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>                <span class="n">idx_A</span> <span class="o">=</span> <span class="n">group</span> <span class="o">+</span> <span class="n">k</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>                <span class="n">idx_B</span> <span class="o">=</span> <span class="n">group</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="n">span</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>                    <span class="p">(</span><span class="n">bA</span><span class="p">,</span> <span class="n">rA</span><span class="p">),</span> <span class="p">(</span><span class="n">bB</span><span class="p">,</span> <span class="n">rB</span><span class="p">)</span> <span class="o">=</span> <span class="n">ram</span><span class="o">.</span><span class="n">check_access</span><span class="p">(</span><span class="n">idx_A</span><span class="p">,</span> <span class="n">idx_B</span><span class="p">)</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>                    <span class="c1"># Formatting for clean output</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>                    <span class="n">bin_A</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx_A</span><span class="si">:</span><span class="s2">03b</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>                    <span class="n">bin_B</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">idx_B</span><span class="si">:</span><span class="s2">03b</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>                    <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;✅ OK&quot;</span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stg </span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">&lt;2</span><span class="si">}</span><span class="s2"> | (</span><span class="si">{</span><span class="n">idx_A</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">idx_B</span><span class="si">}</span><span class="s2">)</span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="si">:</span><span class="s2">&lt;8</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">bin_A</span><span class="si">:</span><span class="s2">&lt;6</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">bin_B</span><span class="si">:</span><span class="s2">&lt;6</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">bA</span><span class="si">:</span><span class="s2">&lt;7</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">bB</span><span class="si">:</span><span class="s2">&lt;7</span><span class="si">}</span><span class="s2"> | </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a>                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stg </span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">&lt;2</span><span class="si">}</span><span class="s2"> | (</span><span class="si">{</span><span class="n">idx_A</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">idx_B</span><span class="si">}</span><span class="s2">) - ❌ FAIL: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>    <span class="n">verify_fft_8_banking</span><span class="p">()</span>
</code></pre></div>
<h3 id="22-conflict-free-memory-xor-strategy-addressing">2.2 Conflict-Free Memory: XOR Strategy &amp; Addressing</h3>
<p>To solve the conflict in Stage 2, we use <strong>Parity Banking</strong>. This ensures that any two addresses differing by 1 bit (Hamming distance 1) always land in different banks.</p>
<p>Running the python verification generates this table. And we can validate that there is no memory access conflict with this approach.
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>Stage<span class="w">  </span><span class="p">|</span><span class="w"> </span>Pair<span class="w"> </span><span class="o">(</span>Logical<span class="o">)</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>Bin<span class="w"> </span>A<span class="w">  </span>Bin<span class="w"> </span>B<span class="w">  </span><span class="p">|</span><span class="w"> </span>Bank<span class="w"> </span>A<span class="w">  </span>Bank<span class="w"> </span>B<span class="w">  </span><span class="p">|</span><span class="w"> </span>Result
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>--------------------------------------------------------------------------------
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>Stg<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">1</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">000</span><span class="w">    </span><span class="m">001</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">0</span><span class="w">       </span><span class="m">1</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>Stg<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">2</span>,<span class="w"> </span><span class="m">3</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">010</span><span class="w">    </span><span class="m">011</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w">       </span><span class="m">0</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>Stg<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">4</span>,<span class="w"> </span><span class="m">5</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">100</span><span class="w">    </span><span class="m">101</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w">       </span><span class="m">0</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>Stg<span class="w"> </span><span class="m">1</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">6</span>,<span class="w"> </span><span class="m">7</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">110</span><span class="w">    </span><span class="m">111</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">0</span><span class="w">       </span><span class="m">1</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>Stg<span class="w"> </span><span class="m">2</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">2</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">000</span><span class="w">    </span><span class="m">010</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">0</span><span class="w">       </span><span class="m">1</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>Stg<span class="w"> </span><span class="m">2</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">1</span>,<span class="w"> </span><span class="m">3</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">001</span><span class="w">    </span><span class="m">011</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w">       </span><span class="m">0</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>Stg<span class="w"> </span><span class="m">2</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">4</span>,<span class="w"> </span><span class="m">6</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">100</span><span class="w">    </span><span class="m">110</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w">       </span><span class="m">0</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>Stg<span class="w"> </span><span class="m">2</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">5</span>,<span class="w"> </span><span class="m">7</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">101</span><span class="w">    </span><span class="m">111</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">0</span><span class="w">       </span><span class="m">1</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>Stg<span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">0</span>,<span class="w"> </span><span class="m">4</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">000</span><span class="w">    </span><span class="m">100</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">0</span><span class="w">       </span><span class="m">1</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>Stg<span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">1</span>,<span class="w"> </span><span class="m">5</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">001</span><span class="w">    </span><span class="m">101</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w">       </span><span class="m">0</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>Stg<span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">2</span>,<span class="w"> </span><span class="m">6</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">010</span><span class="w">    </span><span class="m">110</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">1</span><span class="w">       </span><span class="m">0</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>Stg<span class="w"> </span><span class="m">3</span><span class="w">  </span><span class="p">|</span><span class="w"> </span><span class="o">(</span><span class="m">3</span>,<span class="w"> </span><span class="m">7</span><span class="o">)</span><span class="w">         </span><span class="p">|</span><span class="w"> </span><span class="m">011</span><span class="w">    </span><span class="m">111</span><span class="w">    </span><span class="p">|</span><span class="w"> </span><span class="m">0</span><span class="w">       </span><span class="m">1</span><span class="w">       </span><span class="p">|</span><span class="w"> </span>✅<span class="w"> </span>OK
</code></pre></div></p>
<h2 id="3-twiddle-factor-architecture-rom-optimization">3. Twiddle Factor Architecture (ROM Optimization)</h2>
<p>In an ASIC implementation, calculating sines and cosines on the fly is computationally expensive, and storing a full table for every angle <span class="arithmatex">\(0 \dots 2\pi\)</span> is wasteful. </p>
<p>We use a "Hardware-Friendly" approach relying on <strong>Quarter-Wave Symmetry</strong> to reduce storage by 75% and <strong>Bit-Shifting</strong> to reuse a single Master Table across all FFT stages.</p>
<h3 id="31-quarter-wave-optimization">3.1 Quarter-Wave Optimization</h3>
<p>We only store the <strong>Cosine</strong> values for the first quadrant (<span class="arithmatex">\(0^\circ\)</span> to <span class="arithmatex">\(90^\circ\)</span>).
* <strong>Storage Range:</strong> <span class="arithmatex">\(0 \le \theta \le \pi/2\)</span> (Indices <span class="arithmatex">\(0 \dots N/4\)</span>).
* <strong>Real Part (Cos):</strong> Direct lookup from the table.
* <strong>Imaginary Part (Sin):</strong> Derived using the trigonometric identity:
  $<span class="arithmatex">\(\sin(\theta) = \cos(90^\circ - \theta)\)</span>$</p>
<p>Since we store Cosine, we can find the Sine of any angle <span class="arithmatex">\(k\)</span> by reading the table backwards from the <span class="arithmatex">\(90^\circ\)</span> mark (<span class="arithmatex">\(N/4 - k\)</span>).</p>
<h3 id="32-quadrant-mapping-logic-the-mirror">3.2 Quadrant Mapping Logic (The Mirror)</h3>
<p>Standard FFTs require angles up to <span class="arithmatex">\(180^\circ\)</span> (Quadrant 2). Since our table stops at <span class="arithmatex">\(90^\circ\)</span>, we use geometric mirroring.</p>
<ul>
<li><strong>Mirroring:</strong> An angle in Q2 (e.g., <span class="arithmatex">\(135^\circ\)</span>) uses the same table value as its mirror in Q1 (<span class="arithmatex">\(45^\circ\)</span>), but with a sign change for the Cosine.</li>
<li><strong>The Formula:</strong> <code>Index_Q1 = (N/2) - Index_Q2</code></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Quadrant</th>
<th style="text-align: left;">Angle Range</th>
<th style="text-align: left;">Lookup Index</th>
<th style="text-align: left;">Real Sign (Cos)</th>
<th style="text-align: left;">Imag Sign (<span class="arithmatex">\(-j\sin\)</span>)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Q1</strong></td>
<td style="text-align: left;"><span class="arithmatex">\(0 \dots 90^\circ\)</span></td>
<td style="text-align: left;"><span class="arithmatex">\(k\)</span></td>
<td style="text-align: left;">Positive (<span class="arithmatex">\(+\)</span>)</td>
<td style="text-align: left;">Negative (<span class="arithmatex">\(-\)</span>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Q2</strong></td>
<td style="text-align: left;"><span class="arithmatex">\(90 \dots 180^\circ\)</span></td>
<td style="text-align: left;"><span class="arithmatex">\(N/2 - k\)</span></td>
<td style="text-align: left;">Negative (<span class="arithmatex">\(-\)</span>)</td>
<td style="text-align: left;">Negative (<span class="arithmatex">\(-\)</span>)</td>
</tr>
</tbody>
</table>
<p><em>&gt; </em><em>Note:</em><em> The Imaginary sign is negative in both quadrants because the FFT definition is <span class="arithmatex">\(W = \cos(\theta) - j\sin(\theta)\)</span>. Since <span class="arithmatex">\(\sin(\theta)\)</span> is positive in both Q1 and Q2, the term <span class="arithmatex">\(-j\sin(\theta)\)</span> remains negative.</em></p>
<h3 id="33-hardware-address-decoding-bit-shifting">3.3 Hardware Address Decoding (Bit-Shifting)</h3>
<p>Earlier FFT stages need "lower resolution" angles. Instead of creating separate tables for Stage 1, Stage 2, etc., we use the Master Table (Stage <span class="arithmatex">\(M\)</span>) for everything.</p>
<p>We simply <strong>left-shift</strong> the address to "skip" intermediate values.</p>
<ul>
<li><strong>Formula:</strong> <code>ROM_Addr = k &lt;&lt; (Max_Stages - Current_Stage)</code></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align: left;">Stage</th>
<th style="text-align: left;">Butterfly Index <span class="arithmatex">\(k\)</span></th>
<th style="text-align: left;">Shift</th>
<th style="text-align: left;">Effective Angle</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>3 (Full)</strong></td>
<td style="text-align: left;">0, 1, 2, 3</td>
<td style="text-align: left;">0</td>
<td style="text-align: left;"><span class="arithmatex">\(0, 1, 2, 3\)</span> (<span class="arithmatex">\(0^\circ, 45^\circ \dots\)</span>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>2 (Half)</strong></td>
<td style="text-align: left;">0, 1</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;"><span class="arithmatex">\(0, 2\)</span> (<span class="arithmatex">\(0^\circ, 90^\circ\)</span>)</td>
</tr>
<tr>
<td style="text-align: left;"><strong>1 (Low)</strong></td>
<td style="text-align: left;">0</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;"><span class="arithmatex">\(0\)</span> (<span class="arithmatex">\(0^\circ\)</span>)</td>
</tr>
</tbody>
</table>
<h3 id="34-python-implementation-twiddlerom">3.4 Python Implementation: <code>TwiddleROM</code></h3>
<p>This class models the hardware ROM, the bit-shifting AGU, and the Quadrant Mapping logic.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">TwiddleROM</span><span class="p">:</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="sd">    Hardware-Optimized Twiddle Factor Generator.</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="sd">    - Stores only Quarter-Wave (0 to 90 degrees).</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="sd">    - Uses Quadrant Mirroring for angles &gt; 90 degrees.</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">quarter_size</span> <span class="o">=</span> <span class="n">N</span> <span class="o">//</span> <span class="mi">4</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>        <span class="c1"># 1. Generate the Quarter-Wave LUT (Cosine only)</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>        <span class="c1"># Size: (N/4) + 1 entries.</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lut</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Generating ROM (Size: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">quarter_size</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">) ---&quot;</span><span class="p">)</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quarter_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>            <span class="n">angle</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">i</span> <span class="o">/</span> <span class="n">N</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>            <span class="n">val</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_twiddle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="sd">        Retrieves W = e^(-j 2pi k / 2^stage) using Bit-Shifting &amp; Mirroring.</span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a>        <span class="c1"># 1. Bit-Shift Strategy: Map current stage &#39;k&#39; to Master ROM index</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>        <span class="n">total_stages</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">))</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>        <span class="n">shift</span> <span class="o">=</span> <span class="n">total_stages</span> <span class="o">-</span> <span class="n">stage</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>        <span class="n">master_idx</span> <span class="o">=</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>        <span class="c1"># 2. Quadrant Logic</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>        <span class="k">if</span> <span class="n">master_idx</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">quarter_size</span><span class="p">:</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>            <span class="c1"># Quadrant 2: Mirroring Logic</span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a>            <span class="c1"># Map 135 deg -&gt; 45 deg via (180 - 135)</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a>            <span class="n">lut_idx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">master_idx</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>            <span class="n">sign_re</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Cosine is Negative in Q2</span>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a>            <span class="n">sign_im</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Sine is Positive, so -j*sin is Negative</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a>            <span class="c1"># Quadrant 1: Direct Mapping</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a>            <span class="n">lut_idx</span> <span class="o">=</span> <span class="n">master_idx</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a>            <span class="n">sign_re</span> <span class="o">=</span> <span class="mi">1</span>   <span class="c1"># Cosine is Positive in Q1</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>            <span class="n">sign_im</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># -j*sin is Negative</span>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a>        <span class="c1"># 3. Fetch Real Part (Cosine)</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>        <span class="n">re</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="n">lut_idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">sign_re</span>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>        <span class="c1"># 4. Fetch Imag Part (Sine derived from Cosine)</span>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>        <span class="c1"># sin(theta) = cos(90 - theta) -&gt; Table[Max - Index]</span>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>        <span class="n">im_lut_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quarter_size</span> <span class="o">-</span> <span class="n">lut_idx</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>        <span class="n">im</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lut</span><span class="p">[</span><span class="n">im_lut_idx</span><span class="p">]</span> <span class="o">*</span> <span class="n">sign_im</span>
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>        <span class="k">return</span> <span class="n">re</span><span class="p">,</span> <span class="n">im</span>
</code></pre></div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.tabs", "navigation.sections", "navigation.expand", "search.highlight", "content.code.copy", "navigation.top", "toc.follow", "toc.integrate"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid@10.6.1/dist/mermaid.min.js"></script>
      
    
  </body>
</html>